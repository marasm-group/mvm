;;
;; math -- mathematic functions and constants module
;;
#json
{
    "author":"SR3u",
    "dependencies":["math/trigonometry"],
    "init":"$math_init"
}
#end
$math_init
gvar PI ; 3.14159264
gvar EXPONENT ; 2.71828182846
gvar PI_x2 ; PI*2
gvar PI_HALF ; PI/2
gvar PI_QUARTER ; PI/4
mov PI 3.14159265359
mov EXPONENT 2.71828182846
mul PI_x2 PI 2 ;
div PI_HALF PI 2 ;
div PI_QUARTER PI 4 ;
ret
$powi ; calculates power of a given number (pow must be integer)
var x     ; number
var pow   ; power
pop pow
pop x
var res
mov res 1
@math_pow_loop_0
mul res res x
sub pow pow 1
jnz pow @math_pow_loop_0
push res
ret
$factorial ;  returns x!
var x
pop x
var res
mov res 1
@math_fact_loop_0
mul res res x
sub x x 1
jmz x @math_fact_loop_0
push res
ret
$abs ; returns abs(x)
var x
pop x
jlz x @math_abs_ret_0
push x
ret
@math_abs_ret_0
sub x 0 x
push x
ret